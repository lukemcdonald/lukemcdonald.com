---
import type { ExperienceItem } from '@/features/resume/resume.types'

import ExperienceIcon from '@lucide/astro/icons/shield-ellipsis'

import Link from '@/components/Link.astro'
import Section from '@/features/resume/components/ui/Section.astro'
import { formatMonthYear } from '@/utils/dates'

export interface Props {
  experience: ExperienceItem[]
}

const { experience } = Astro.props
---

<Section
  title="Experience"
  items={experience}
  icon={ExperienceIcon}
  itemsClass="flex flex-col gap-2 !m-0"
>
  <template slot="item">
    {
      (item: ExperienceItem) => {
        const startDate = item.startDate
        const endDate = item.endDate

        const startDateFormatted = formatMonthYear(startDate)
        const startDateLabel = startDateFormatted || startDate || 'Unknown'
        const endDateFormatted = formatMonthYear(endDate)
        const endDateLabel = endDateFormatted || endDate || 'Present'

        const startDateHtml = startDateFormatted ? <time datetime={startDate}>{startDateLabel}</time> : <span>{startDateLabel}</span>
        const endDateHtml = endDateFormatted ? <time datetime={endDate}>{endDateLabel}</time> : <span>Present</span>

        return (
          <div>
            <h3 class="not-prose font-semibold text-primary-900 dark:text-primary-100">
              {item.website ?
                <Link
                  href={item.website}
                  class="font-inherit"
                >
                  {item.company}
                </Link>
              : item.company}{' '}
              — {item.position}
            </h3>

            <p class="uppercase text-sm mt-1">
              <span aria-label={`${startDateLabel} until ${endDateLabel}`}>
                {startDateHtml}–{endDateHtml},
              </span>
              {item.location}
            </p>

            {item.summary && (
              <p
                class="mt-2"
                set:html={item.summary}
              />
            )}

            {item.highlights && (
              <ul class="!m-0">
                {item.highlights.map((highlight: string) => (
                  <li set:html={highlight} />
                ))}
              </ul>
            )}
          </div>
        )
      }
    }
  </template>
</Section>
