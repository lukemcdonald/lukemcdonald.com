---
import type { ExperienceItem } from '@/features/resume/resume.types'

import ExperienceIcon from '@lucide/astro/icons/shield-ellipsis'

import Link from '@/components/Link.astro'
import Section from '@/features/resume/components/ui/Section.astro'
import { formatMonthYear } from '@/utils/dates'

export interface Props {
  experience: ExperienceItem[]
}

const { experience } = Astro.props
---

<Section
  title="Experience"
  items={experience}
  icon={ExperienceIcon}
  itemsClass="flex flex-col gap-2 !m-0"
>
  <template slot="item">
    {
      (item: ExperienceItem) => {
        const startDate = item.startDate
        const endDate = item.endDate

        const startDateLabel = formatMonthYear(startDate) || startDate || 'Unknown'
        const endDateLabel = formatMonthYear(endDate) || endDate || 'Present'

        return (
          <div>
            <h3 class="not-prose font-semibold text-primary-900 dark:text-primary-100">
              {item.website ?
                <Link
                  href={item.website}
                  class="font-inherit"
                >
                  {item.company}
                </Link>
              : item.company}{' '}
              — {item.position}
            </h3>

            <em class="text-primary-600 dark:text-primary-400">
              <span aria-label={`${startDateLabel} until ${endDateLabel}`}>
                <time datetime={startDate}>{startDateLabel}</time>
                <span aria-hidden="true">&nbsp;–&nbsp;</span>
                {endDate ?
                  <time datetime={endDate}>{endDateLabel}</time>
                : <span>Present</span>}
              </span>
              | {item.location}
            </em>

            {item.summary && <p class="mt-2">{item.summary}</p>}

            {item.highlights && (
              <ul class="!m-0">
                {item.highlights.map((highlight: string) => (
                  <li>{highlight}</li>
                ))}
              </ul>
            )}
          </div>
        )
      }
    }
  </template>
</Section>
