---
import Layout from '@/layouts/Layout.astro'
import DarkModeToggle from '@/components/DarkModeToggle.astro'

import Header from './components/Header.astro'
import Skills from './components/Skills.astro'
import Experience from './components/Experience.astro'
import Awards from './components/Awards.astro'
import Education from './components/Education.astro'
import Personal from './components/Personal.astro'
import Footer from './components/Footer.astro'
import type {
  AwardsData,
  BasicsData,
  EducationData,
  ExperienceData,
  PersonalData,
  SkillsData,
} from './types'

const base = new URL(Astro.request.url)
const fetchJson = (path: string) => fetch(new URL(path, base)).then((r) => r.json())

const resume: Record<string, unknown> = await fetchJson('/api/resume.json')

if (!resume) {
  throw new Response('Failed to fetch resume', { status: 500 })
}

const awards: AwardsData = resume.awards
const basics: BasicsData = resume.basics
const education: EducationData = resume.education
const experience: ExperienceData = resume.experience
const personal: PersonalData = resume.personal
const skills: SkillsData = resume.skills
---

<Layout title="Resume">
  <main class="px-4">
    <button
      class="fixed top-4 right-4 rounded-md bg-blue-600 px-4 py-2 font-medium text-white shadow-sm hover:bg-blue-700 print:hidden"
      onclick="window.print()"
    >
      ðŸ“„ Download PDF
    </button>

    <article class="mx-auto prose">
      <Header basics={basics} />

      <Skills skills={skills} />
      <Experience experience={experience} />
      <Awards awards={awards} />
      <Education education={education} />
      <Personal personal={personal} />

      <Footer />
    </article>
  </main>
</Layout>
